{% extends "base.html" %}
{% block app_content %}

  <h1>Aktuelles Rennen</h1>

  <div class="d-flex flex-row justify-content-right mb1 status">
    <div class="p2">
      <dl>
        <dt>CU:</dt>
        <dd id="control_unit_status">nicht verbunden</dd>
      </dl>
    </div>
  </div>

  {% if current_race and current_race.parsed_grid()%}
    <div class="d-flex flex-row justify-content-center  mb-3 bd-highlight ">
      {% for grid_entry in current_race.parsed_grid()%}
      <div class= "p-2 grid-entry" id = "grid-entry-{{ grid_entry['controller'] }}">
        <div class= "racer-name">{{ grid_entry['racer'].name }} ({{ grid_entry['car'].name }})</div>
        <div id = "fuel_{{ grid_entry['controller'] }}" class = "d-flex flex-row">
          <i class="fa fa-gas-pump p-2"></i>
          {% for i in range(0,16) %}
            <div class = "square fuel-{{i}}" id="fuel-level-{{grid_entry['controller']}}-{{i}}"> </div>
          {% endfor %}
        </div>
        <div id = "in_pit_{{ grid_entry['controller'] }}"></div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

  <script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
  <script type="text/javascript" charset="utf-8">
    var socket = io.connect('http://' + document.domain + ':' + location.port + '/control_unit_events', {
    upgrade: false,
    transports: ['websocket']});
    socket.on('connect', function() {
        socket.emit('control_unit_events', {data: 'I\'m connected!'});
    });
    socket.on('status', function(msg) {
      console.log("CU status: " + msg);
      $("#control_unit_status").text(msg)
    });
  </script>

  <script type="text/javascript" charset="utf-8">
    var socket = io.connect('http://' + document.domain + ':' + location.port + '/pit_events', {
    upgrade: false,
    transports: ['websocket']});
    socket.on('connect', function() {
        socket.emit('pit_events', {data: 'I\'m connected!'});
    });
    socket.on('control_unit_connected', function() {
      console.log("Control Unit connected");
    });
    socket.on('control_unit_not_connected', function() {
      console.log("Control Unit not connected");
    });

    socket.on('track_events', function(msg) {
      console.log(msg);
    });
    socket.on('message', function(msg) {
      console.log(msg);
    });
    socket.on('event', function(msg){
      console.log(msg);
    });
  </script>
{% endblock %}